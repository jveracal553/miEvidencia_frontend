{"ast":null,"code":"import _slicedToArray from\"/Users/shadowm/Documents/final_project/mi_evidencia/mievidencia_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import{Link,useNavigate}from\"react-router-dom\";import{v4 as uuidv4}from\"uuid\";import{MdDownloadForOffline}from\"react-icons/md\";import{AiTwotoneDelete}from\"react-icons/ai\";import{BsFillArrowUpRightCircleFill}from\"react-icons/bs\";import{client,urlFor}from\"../client\";import{fetchUser}from\"../utils/fetchUser\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Pin=function Pin(_ref){var _pin$save,_alreadySaved,_image$asset,_alreadySaved3,_pin$save2,_pin$save3;var pin=_ref.pin;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),postHovered=_useState2[0],setPostHovered=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),savingPost=_useState4[0],setSavingPost=_useState4[1];var navigate=useNavigate();var postedBy=pin.postedBy,image=pin.image,_id=pin._id,destination=pin.destination;var user=fetchUser();// localStorage.getItem(\"user\") !== \"undefined\"\n//   ? JSON.parse(localStorage.getItem(\"user\"))\n//   : localStorage.clear();\nvar deletePin=function deletePin(id){client.delete(id).then(function(){window.location.reload();});};var alreadySaved=pin===null||pin===void 0?void 0:(_pin$save=pin.save)===null||_pin$save===void 0?void 0:_pin$save.filter(function(item){var _item$postedBy;return(item===null||item===void 0?void 0:(_item$postedBy=item.postedBy)===null||_item$postedBy===void 0?void 0:_item$postedBy._id)===(user===null||user===void 0?void 0:user.googleId);});alreadySaved=((_alreadySaved=alreadySaved)===null||_alreadySaved===void 0?void 0:_alreadySaved.length)>0?alreadySaved:[];var savePin=function savePin(id){var _alreadySaved2;if(((_alreadySaved2=alreadySaved)===null||_alreadySaved2===void 0?void 0:_alreadySaved2.length)===0){setSavingPost(true);client.patch(id).setIfMissing({save:[]}).insert(\"after\",\"save[-1]\",[{_key:uuidv4(),userId:user===null||user===void 0?void 0:user.googleId,postedBy:{_type:\"postedBy\",_ref:user===null||user===void 0?void 0:user.googleId}}]).commit().then(function(){window.location.reload();setSavingPost(false);});}};return/*#__PURE__*/_jsxs(\"div\",{className:\"m-2\",children:[/*#__PURE__*/_jsxs(\"div\",{onMouseEnter:function onMouseEnter(){return setPostHovered(true);},onMouseLeave:function onMouseLeave(){return setPostHovered(false);},onClick:function onClick(){return navigate(\"/pin-detail/\".concat(_id));},className:\" relative cursor-zoom-in w-auto hover:shadow-lg rounded-lg overflow-hidden transition-all duration-500 ease-in-out\",children:[image&&/*#__PURE__*/_jsx(\"img\",{className:\"rounded-lg w-full \",src:urlFor(image).width(250).url(),alt:\"user-post\"}),postHovered&&/*#__PURE__*/_jsxs(\"div\",{className:\"absolute top-0 w-full h-full flex flex-col justify-between p-1 pr-2 pt-2 pb-2 z-50\",style:{height:\"100%\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-2\",children:/*#__PURE__*/_jsx(\"a\",{href:\"\".concat(image===null||image===void 0?void 0:(_image$asset=image.asset)===null||_image$asset===void 0?void 0:_image$asset.url,\"?dl=\"),download:true,onClick:function onClick(e){e.stopPropagation();},className:\"bg-white w-9 h-9 p-2 rounded-full flex items-center justify-center text-dark text-xl opacity-75 hover:opacity-100 hover:shadow-md outline-none\",children:/*#__PURE__*/_jsx(MdDownloadForOffline,{})})}),((_alreadySaved3=alreadySaved)===null||_alreadySaved3===void 0?void 0:_alreadySaved3.length)!==0?/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"bg-red-500 opacity-70 hover:opacity-100 text-white font-bold px-5 py-1 text-base rounded-3xl hover:shadow-md outline-none\",children:[pin===null||pin===void 0?void 0:(_pin$save2=pin.save)===null||_pin$save2===void 0?void 0:_pin$save2.length,\" Saved\"]}):/*#__PURE__*/_jsxs(\"button\",{onClick:function onClick(e){e.stopPropagation();savePin(_id);},type:\"button\",className:\"bg-red-500 opacity-70 hover:opacity-100 text-white font-bold px-5 py-1 text-base rounded-3xl hover:shadow-md outline-none\",children:[pin===null||pin===void 0?void 0:(_pin$save3=pin.save)===null||_pin$save3===void 0?void 0:_pin$save3.length,\" \",savingPost?\"Saving\":\"Save\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\" flex justify-between items-center gap-2 w-full\",children:[(destination===null||destination===void 0?void 0:destination.slice(8).length)>0?/*#__PURE__*/_jsxs(\"a\",{href:destination,target:\"_blank\",className:\"bg-white flex items-center gap-2 text-black font-bold p-2 pl-4 pr-4 rounded-full opacity-70 hover:opacity-100 hover:shadow-md\",rel:\"noreferrer\",children:[\" \",/*#__PURE__*/_jsx(BsFillArrowUpRightCircleFill,{}),destination===null||destination===void 0?void 0:destination.slice(8,17),\"...\"]}):undefined,(postedBy===null||postedBy===void 0?void 0:postedBy._id)===(user===null||user===void 0?void 0:user.googleId)&&/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:function onClick(e){e.stopPropagation();deletePin(_id);},className:\"bg-white p-2 rounded-full w-8 h-8 flex items-center justify-center text-dark opacity-75 hover:opacity-100 outline-none\",children:/*#__PURE__*/_jsx(AiTwotoneDelete,{})})]})]})]}),/*#__PURE__*/_jsxs(Link,{to:\"/user-profile/\".concat(postedBy===null||postedBy===void 0?void 0:postedBy._id),className:\"flex gap-2 mt-2 items-center\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"w-8 h-8 rounded-full object-cover\",src:postedBy===null||postedBy===void 0?void 0:postedBy.image,alt:\"user-profile\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold capitalize\",children:postedBy===null||postedBy===void 0?void 0:postedBy.userName})]})]});};export default Pin;","map":{"version":3,"names":["React","useState","Link","useNavigate","v4","uuidv4","MdDownloadForOffline","AiTwotoneDelete","BsFillArrowUpRightCircleFill","client","urlFor","fetchUser","Pin","pin","postHovered","setPostHovered","savingPost","setSavingPost","navigate","postedBy","image","_id","destination","user","deletePin","id","delete","then","window","location","reload","alreadySaved","save","filter","item","googleId","length","savePin","patch","setIfMissing","insert","_key","userId","_type","_ref","commit","width","url","height","asset","e","stopPropagation","slice","undefined","userName"],"sources":["/Users/shadowm/Documents/final_project/mi_evidencia/mievidencia_frontend/src/components/Pin.jsx"],"sourcesContent":["import React, { useState } from \"react\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { MdDownloadForOffline } from \"react-icons/md\";\nimport { AiTwotoneDelete } from \"react-icons/ai\";\nimport { BsFillArrowUpRightCircleFill } from \"react-icons/bs\";\n\nimport { client, urlFor } from \"../client\";\nimport { fetchUser } from \"../utils/fetchUser\";\n\nconst Pin = ({ pin }) => {\n  const [postHovered, setPostHovered] = useState(false);\n  const [savingPost, setSavingPost] = useState(false);\n\n  const navigate = useNavigate();\n\n  const { postedBy, image, _id, destination } = pin;\n\n  const user = fetchUser();\n  // localStorage.getItem(\"user\") !== \"undefined\"\n  //   ? JSON.parse(localStorage.getItem(\"user\"))\n  //   : localStorage.clear();\n\n  const deletePin = (id) => {\n    client.delete(id).then(() => {\n      window.location.reload();\n    });\n  };\n\n  let alreadySaved = pin?.save?.filter(\n    (item) => item?.postedBy?._id === user?.googleId\n  );\n\n  alreadySaved = alreadySaved?.length > 0 ? alreadySaved : [];\n\n  const savePin = (id) => {\n    if (alreadySaved?.length === 0) {\n      setSavingPost(true);\n\n      client\n        .patch(id)\n        .setIfMissing({ save: [] })\n        .insert(\"after\", \"save[-1]\", [\n          {\n            _key: uuidv4(),\n            userId: user?.googleId,\n            postedBy: {\n              _type: \"postedBy\",\n              _ref: user?.googleId,\n            },\n          },\n        ])\n        .commit()\n        .then(() => {\n          window.location.reload();\n          setSavingPost(false);\n        });\n    }\n  };\n\n  return (\n    <div className=\"m-2\">\n      <div\n        onMouseEnter={() => setPostHovered(true)}\n        onMouseLeave={() => setPostHovered(false)}\n        onClick={() => navigate(`/pin-detail/${_id}`)}\n        className=\" relative cursor-zoom-in w-auto hover:shadow-lg rounded-lg overflow-hidden transition-all duration-500 ease-in-out\"\n      >\n        {image && (\n          <img\n            className=\"rounded-lg w-full \"\n            src={urlFor(image).width(250).url()}\n            alt=\"user-post\"\n          />\n        )}\n        {postHovered && (\n          <div\n            className=\"absolute top-0 w-full h-full flex flex-col justify-between p-1 pr-2 pt-2 pb-2 z-50\"\n            style={{ height: \"100%\" }}\n          >\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex gap-2\">\n                <a\n                  href={`${image?.asset?.url}?dl=`}\n                  download\n                  onClick={(e) => {\n                    e.stopPropagation();\n                  }}\n                  className=\"bg-white w-9 h-9 p-2 rounded-full flex items-center justify-center text-dark text-xl opacity-75 hover:opacity-100 hover:shadow-md outline-none\"\n                >\n                  <MdDownloadForOffline />\n                </a>\n              </div>\n              {alreadySaved?.length !== 0 ? (\n                <button\n                  type=\"button\"\n                  className=\"bg-red-500 opacity-70 hover:opacity-100 text-white font-bold px-5 py-1 text-base rounded-3xl hover:shadow-md outline-none\"\n                >\n                  {pin?.save?.length} Saved\n                </button>\n              ) : (\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    savePin(_id);\n                  }}\n                  type=\"button\"\n                  className=\"bg-red-500 opacity-70 hover:opacity-100 text-white font-bold px-5 py-1 text-base rounded-3xl hover:shadow-md outline-none\"\n                >\n                  {pin?.save?.length} {savingPost ? \"Saving\" : \"Save\"}\n                </button>\n              )}\n            </div>\n            <div className=\" flex justify-between items-center gap-2 w-full\">\n              {destination?.slice(8).length > 0 ? (\n                <a\n                  href={destination}\n                  target=\"_blank\"\n                  className=\"bg-white flex items-center gap-2 text-black font-bold p-2 pl-4 pr-4 rounded-full opacity-70 hover:opacity-100 hover:shadow-md\"\n                  rel=\"noreferrer\"\n                >\n                  {\" \"}\n                  <BsFillArrowUpRightCircleFill />\n                  {destination?.slice(8, 17)}...\n                </a>\n              ) : undefined}\n              {postedBy?._id === user?.googleId && (\n                <button\n                  type=\"button\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    deletePin(_id);\n                  }}\n                  className=\"bg-white p-2 rounded-full w-8 h-8 flex items-center justify-center text-dark opacity-75 hover:opacity-100 outline-none\"\n                >\n                  <AiTwotoneDelete />\n                </button>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n      <Link\n        to={`/user-profile/${postedBy?._id}`}\n        className=\"flex gap-2 mt-2 items-center\"\n      >\n        <img\n          className=\"w-8 h-8 rounded-full object-cover\"\n          src={postedBy?.image}\n          alt=\"user-profile\"\n        />\n        <p className=\"font-semibold capitalize\">{postedBy?.userName}</p>\n      </Link>\n    </div>\n  );\n};\n\nexport default Pin;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
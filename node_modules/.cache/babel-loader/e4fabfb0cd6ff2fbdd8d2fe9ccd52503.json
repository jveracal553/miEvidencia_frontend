{"ast":null,"code":"'use strict';\n\nvar global = require('../util/global');\n\nvar objectAssign = require('object-assign');\n\nmodule.exports = function () {\n  var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var Observable = opts.implementation || global.Observable;\n\n  if (!Observable) {\n    throw new Error('`Observable` is not available in global scope, and no implementation was passed');\n  }\n\n  return {\n    onReturn: function onReturn(channels, context) {\n      return new Observable(function (observer) {\n        channels.error.subscribe(function (err) {\n          return observer.error(err);\n        });\n        channels.progress.subscribe(function (event) {\n          return observer.next(objectAssign({\n            type: 'progress'\n          }, event));\n        });\n        channels.response.subscribe(function (response) {\n          observer.next(objectAssign({\n            type: 'response'\n          }, response));\n          observer.complete();\n        });\n        channels.request.publish(context);\n        return function () {\n          return channels.abort.publish();\n        };\n      });\n    }\n  };\n};","map":{"version":3,"mappings":";;AAAA,IAAMA,SAASC,QAAQ,gBAARA,CAAf;;AACA,IAAMC,eAAeD,QAAQ,eAARA,CAArB;;AAEAE,OAAOC,OAAPD,GAAiB,YAAe;EAAA,IAAdE,IAAc,uEAAP,EAAO;EAC9B,IAAMC,aAAaD,KAAKE,cAALF,IAAuBL,OAAOM,UAAjD;;EACA,IAAI,CAACA,UAAL,EAAiB;IACf,MAAM,IAAIE,KAAJ,CACJ,iFADI,CAAN;EAGD;;EAED,OAAO;IACLC,UAAU,kBAACC,QAAD,EAAWC,OAAX;MAAA,OACR,IAAIL,UAAJ,CAAe,oBAAY;QACzBI,SAASE,KAATF,CAAeG,SAAfH,CAAyB;UAAA,OAAOI,SAASF,KAATE,CAAeC,GAAfD,CAAP;QAAzB;QACAJ,SAASM,QAATN,CAAkBG,SAAlBH,CAA4B;UAAA,OAASI,SAASG,IAATH,CAAcZ,aAAa;YAACgB,MAAM;UAAP,CAAbhB,EAAiCiB,KAAjCjB,CAAdY,CAAT;QAA5B;QACAJ,SAASU,QAATV,CAAkBG,SAAlBH,CAA4B,oBAAY;UACtCI,SAASG,IAATH,CAAcZ,aAAa;YAACgB,MAAM;UAAP,CAAbhB,EAAiCkB,QAAjClB,CAAdY;UACAA,SAASO,QAATP;QAFF;QAKAJ,SAASY,OAATZ,CAAiBa,OAAjBb,CAAyBC,OAAzBD;QACA,OAAO;UAAA,OAAMA,SAASc,KAATd,CAAea,OAAfb,EAAN;QAAP;MATF,EADQ;IAAA;EADL,CAAP;AARF","names":["global","require","objectAssign","module","exports","opts","Observable","implementation","Error","onReturn","channels","context","error","subscribe","observer","err","progress","next","type","event","response","complete","request","publish","abort"],"sources":["../../src/middleware/observable.js"],"sourcesContent":["const global = require('../util/global')\nconst objectAssign = require('object-assign')\n\nmodule.exports = (opts = {}) => {\n  const Observable = opts.implementation || global.Observable\n  if (!Observable) {\n    throw new Error(\n      '`Observable` is not available in global scope, and no implementation was passed'\n    )\n  }\n\n  return {\n    onReturn: (channels, context) =>\n      new Observable(observer => {\n        channels.error.subscribe(err => observer.error(err))\n        channels.progress.subscribe(event => observer.next(objectAssign({type: 'progress'}, event)))\n        channels.response.subscribe(response => {\n          observer.next(objectAssign({type: 'response'}, response))\n          observer.complete()\n        })\n\n        channels.request.publish(context)\n        return () => channels.abort.publish()\n      })\n  }\n}\n"]},"metadata":{},"sourceType":"script"}
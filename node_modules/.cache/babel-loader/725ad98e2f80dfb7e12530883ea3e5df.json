{"ast":null,"code":"import _slicedToArray from\"/Users/shadowm/Documents/final_project/mi_evidencia/mievidencia_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{MdDownloadForOffline}from\"react-icons/md\";import{Link,useParams}from\"react-router-dom\";import{v4 as uuidv4}from\"uuid\";import{client,urlFor}from\"../client\";import MasonryLayout from\"./MasonryLayout\";import{pinDetailMorePinQuery,pinDetailQuery}from\"../utils/data\";import Spinner from\"./Spinner\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var PinDetail=function PinDetail(_ref){var _pinDetail$destinatio,_pinDetail$comments;var user=_ref.user;var _useParams=useParams(),pinId=_useParams.pinId;var _useState=useState(),_useState2=_slicedToArray(_useState,2),pins=_useState2[0],setPins=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),pinDetail=_useState4[0],setPinDetail=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),comment=_useState6[0],setComment=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),addingComment=_useState8[0],setAddingComment=_useState8[1];var fetchPinDetails=function fetchPinDetails(){var query=pinDetailQuery(pinId);if(query){client.fetch(\"\".concat(query)).then(function(data){setPinDetail(data[0]);console.log(data);if(data[0]){var query1=pinDetailMorePinQuery(data[0]);client.fetch(query1).then(function(res){setPins(res);});}});}};useEffect(function(){fetchPinDetails();},[pinId]);var addComment=function addComment(){if(comment){setAddingComment(true);client.patch(pinId).setIfMissing({comments:[]}).insert(\"after\",\"comments[-1]\",[{comment:comment,_key:uuidv4(),postedBy:{_type:\"postedBy\",_ref:user._id}}]).commit().then(function(){fetchPinDetails();setComment(\"\");setAddingComment(false);});}};if(!pinDetail){return/*#__PURE__*/_jsx(Spinner,{message:\"Showing pin\"});}return/*#__PURE__*/_jsxs(_Fragment,{children:[pinDetail&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex xl:flex-row flex-col m-auto bg-white\",style:{maxWidth:\"1500px\",borderRadius:\"32px\"},children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center md:items-start flex-initial\",children:/*#__PURE__*/_jsx(\"img\",{className:\"rounded-t-3xl rounded-b-lg\",src:(pinDetail===null||pinDetail===void 0?void 0:pinDetail.image)&&urlFor(pinDetail===null||pinDetail===void 0?void 0:pinDetail.image).url(),alt:\"user-post\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full p-5 flex-1 xl:min-w-620\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-2 items-center\",children:/*#__PURE__*/_jsx(\"a\",{href:\"\".concat(pinDetail.image.asset.url,\"?dl=\"),download:true,className:\"bg-secondaryColor p-2 text-xl rounded-full flex items-center justify-center text-dark opacity-75 hover:opacity-100\",children:/*#__PURE__*/_jsx(MdDownloadForOffline,{})})}),/*#__PURE__*/_jsx(\"a\",{href:pinDetail.destination,target:\"_blank\",rel:\"noreferrer\",children:(_pinDetail$destinatio=pinDetail.destination)===null||_pinDetail$destinatio===void 0?void 0:_pinDetail$destinatio.slice(8)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-4xl font-bold break-words mt-3\",children:pinDetail.title}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-3\",children:pinDetail.about})]}),/*#__PURE__*/_jsxs(Link,{to:\"/user-profile/\".concat(pinDetail===null||pinDetail===void 0?void 0:pinDetail.postedBy._id),className:\"flex gap-2 mt-5 items-center bg-white rounded-lg \",children:[/*#__PURE__*/_jsx(\"img\",{src:pinDetail===null||pinDetail===void 0?void 0:pinDetail.postedBy.image,className:\"w-10 h-10 rounded-full\",alt:\"user-profile\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-bold\",children:pinDetail===null||pinDetail===void 0?void 0:pinDetail.postedBy.userName})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"mt-5 text-2xl\",children:\"Comments\"}),/*#__PURE__*/_jsx(\"div\",{className:\"max-h-370 overflow-y-auto\",children:pinDetail===null||pinDetail===void 0?void 0:(_pinDetail$comments=pinDetail.comments)===null||_pinDetail$comments===void 0?void 0:_pinDetail$comments.map(function(item){var _item$postedBy,_item$postedBy2;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2 mt-5 items-center bg-white rounded-lg\",children:[/*#__PURE__*/_jsx(\"img\",{src:(_item$postedBy=item.postedBy)===null||_item$postedBy===void 0?void 0:_item$postedBy.image,className:\"w-10 h-10 rounded-full cursor-pointer\",alt:\"user-profile\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-bold\",children:(_item$postedBy2=item.postedBy)===null||_item$postedBy2===void 0?void 0:_item$postedBy2.userName}),/*#__PURE__*/_jsx(\"p\",{children:item.comment})]})]},item.comment);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap mt-6 gap-3\",children:[/*#__PURE__*/_jsx(Link,{to:\"/user-profile/\".concat(user._id),children:/*#__PURE__*/_jsx(\"img\",{src:user.image,className:\"w-10 h-10 rounded-full cursor-pointer\",alt:\"user-profile\"})}),/*#__PURE__*/_jsx(\"input\",{className:\" flex-1 border-gray-100 outline-none border-2 p-2 rounded-2xl focus:border-gray-300\",type:\"text\",placeholder:\"Add a comment\",value:comment,onChange:function onChange(e){return setComment(e.target.value);}}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"bg-red-500 text-white rounded-full px-6 py-2 font-semibold text-base outline-none\",onClick:addComment,children:addingComment?\"Doing...\":\"Done\"})]})]})]}),(pins===null||pins===void 0?void 0:pins.length)>0&&/*#__PURE__*/_jsx(\"h2\",{className:\"text-center font-bold text-2xl mt-8 mb-4\",children:\"More like this\"}),pins?/*#__PURE__*/_jsx(MasonryLayout,{pins:pins}):/*#__PURE__*/_jsx(Spinner,{message:\"Loading more pins\"})]});};export default PinDetail;","map":{"version":3,"names":["React","useEffect","useState","MdDownloadForOffline","Link","useParams","v4","uuidv4","client","urlFor","MasonryLayout","pinDetailMorePinQuery","pinDetailQuery","Spinner","PinDetail","user","pinId","pins","setPins","pinDetail","setPinDetail","comment","setComment","addingComment","setAddingComment","fetchPinDetails","query","fetch","then","data","console","log","query1","res","addComment","patch","setIfMissing","comments","insert","_key","postedBy","_type","_ref","_id","commit","maxWidth","borderRadius","image","url","asset","destination","slice","title","about","userName","map","item","e","target","value","length"],"sources":["/Users/shadowm/Documents/final_project/mi_evidencia/mievidencia_frontend/src/components/PinDetail.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { MdDownloadForOffline } from \"react-icons/md\";\nimport { Link, useParams } from \"react-router-dom\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { client, urlFor } from \"../client\";\nimport MasonryLayout from \"./MasonryLayout\";\nimport { pinDetailMorePinQuery, pinDetailQuery } from \"../utils/data\";\nimport Spinner from \"./Spinner\";\n\nconst PinDetail = ({ user }) => {\n  const { pinId } = useParams();\n  const [pins, setPins] = useState();\n  const [pinDetail, setPinDetail] = useState();\n  const [comment, setComment] = useState(\"\");\n  const [addingComment, setAddingComment] = useState(false);\n\n  const fetchPinDetails = () => {\n    const query = pinDetailQuery(pinId);\n\n    if (query) {\n      client.fetch(`${query}`).then((data) => {\n        setPinDetail(data[0]);\n        console.log(data);\n        if (data[0]) {\n          const query1 = pinDetailMorePinQuery(data[0]);\n          client.fetch(query1).then((res) => {\n            setPins(res);\n          });\n        }\n      });\n    }\n  };\n\n  useEffect(() => {\n    fetchPinDetails();\n  }, [pinId]);\n\n  const addComment = () => {\n    if (comment) {\n      setAddingComment(true);\n\n      client\n        .patch(pinId)\n        .setIfMissing({ comments: [] })\n        .insert(\"after\", \"comments[-1]\", [\n          {\n            comment,\n            _key: uuidv4(),\n            postedBy: { _type: \"postedBy\", _ref: user._id },\n          },\n        ])\n        .commit()\n        .then(() => {\n          fetchPinDetails();\n          setComment(\"\");\n          setAddingComment(false);\n        });\n    }\n  };\n\n  if (!pinDetail) {\n    return <Spinner message=\"Showing pin\" />;\n  }\n\n  return (\n    <>\n      {pinDetail && (\n        <div\n          className=\"flex xl:flex-row flex-col m-auto bg-white\"\n          style={{ maxWidth: \"1500px\", borderRadius: \"32px\" }}\n        >\n          <div className=\"flex justify-center items-center md:items-start flex-initial\">\n            <img\n              className=\"rounded-t-3xl rounded-b-lg\"\n              src={pinDetail?.image && urlFor(pinDetail?.image).url()}\n              alt=\"user-post\"\n            />\n          </div>\n          <div className=\"w-full p-5 flex-1 xl:min-w-620\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex gap-2 items-center\">\n                <a\n                  href={`${pinDetail.image.asset.url}?dl=`}\n                  download\n                  className=\"bg-secondaryColor p-2 text-xl rounded-full flex items-center justify-center text-dark opacity-75 hover:opacity-100\"\n                >\n                  <MdDownloadForOffline />\n                </a>\n              </div>\n              <a href={pinDetail.destination} target=\"_blank\" rel=\"noreferrer\">\n                {pinDetail.destination?.slice(8)}\n              </a>\n            </div>\n            <div>\n              <h1 className=\"text-4xl font-bold break-words mt-3\">\n                {pinDetail.title}\n              </h1>\n              <p className=\"mt-3\">{pinDetail.about}</p>\n            </div>\n            <Link\n              to={`/user-profile/${pinDetail?.postedBy._id}`}\n              className=\"flex gap-2 mt-5 items-center bg-white rounded-lg \"\n            >\n              <img\n                src={pinDetail?.postedBy.image}\n                className=\"w-10 h-10 rounded-full\"\n                alt=\"user-profile\"\n              />\n              <p className=\"font-bold\">{pinDetail?.postedBy.userName}</p>\n            </Link>\n            <h2 className=\"mt-5 text-2xl\">Comments</h2>\n            <div className=\"max-h-370 overflow-y-auto\">\n              {pinDetail?.comments?.map((item) => (\n                <div\n                  className=\"flex gap-2 mt-5 items-center bg-white rounded-lg\"\n                  key={item.comment}\n                >\n                  <img\n                    src={item.postedBy?.image}\n                    className=\"w-10 h-10 rounded-full cursor-pointer\"\n                    alt=\"user-profile\"\n                  />\n                  <div className=\"flex flex-col\">\n                    <p className=\"font-bold\">{item.postedBy?.userName}</p>\n                    <p>{item.comment}</p>\n                  </div>\n                </div>\n              ))}\n            </div>\n            <div className=\"flex flex-wrap mt-6 gap-3\">\n              <Link to={`/user-profile/${user._id}`}>\n                <img\n                  src={user.image}\n                  className=\"w-10 h-10 rounded-full cursor-pointer\"\n                  alt=\"user-profile\"\n                />\n              </Link>\n              <input\n                className=\" flex-1 border-gray-100 outline-none border-2 p-2 rounded-2xl focus:border-gray-300\"\n                type=\"text\"\n                placeholder=\"Add a comment\"\n                value={comment}\n                onChange={(e) => setComment(e.target.value)}\n              />\n              <button\n                type=\"button\"\n                className=\"bg-red-500 text-white rounded-full px-6 py-2 font-semibold text-base outline-none\"\n                onClick={addComment}\n              >\n                {addingComment ? \"Doing...\" : \"Done\"}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n      {pins?.length > 0 && (\n        <h2 className=\"text-center font-bold text-2xl mt-8 mb-4\">\n          More like this\n        </h2>\n      )}\n      {pins ? (\n        <MasonryLayout pins={pins} />\n      ) : (\n        <Spinner message=\"Loading more pins\" />\n      )}\n    </>\n  );\n};\n\nexport default PinDetail;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}